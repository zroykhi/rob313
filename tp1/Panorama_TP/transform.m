% Q1
imrgb = double(imread('Pompei.jpg'))/255;
imagesc(imrgb);

PtO = [142.44, 44.894, 1; 356.15, 45.761, 1; 111.86, 253.53, 1;370.59, 260.03, 1]'
PtD = [120, 20, 1; 320, 20, 1; 120, 320, 1; 320, 320, 1]'
H = homography2d(PtO,PtD);
imagesc(vgg_warp_H(imrgb,H))

% Q2.1
img2 = double(imread('Amst-2.jpg'))/255;
imagesc(img2)
img3 = double(imread('Amst-3.jpg'))/255;
imagesc(img3)
PtO = [404.08, 154.16, 1;424.04, 154.16, 1;404.08, 186.18, 1;424.04, 186.18, 1;410.18,120.78,1;435.78,122.09,1;404.27,166.2,1;423.31,165.54,1;404.27,171.46,1;423.96,171.46,1;411.34,145.42,1;426.72,144.1,1;476.13,226.51,1;]';
PtD = [22.609, 152.03, 1;43.007, 152.03, 1;22.609, 184.82, 1;43.007, 184.82, 1;30.803,118.02,1;57.783,120.76,1;22.983,165.16,1;43.706,164.61,1;22.592,170.09,1;43.315,170.09,1;30.125,143.27,1;46.771,142.63,1;94.187,225.4,1]';
H1 = homography2d(PtO,PtD);
bbox = [-1000, 500, -100, 500];
ima=vgg_warp_H(img2,H1,'linear',bbox);
imagesc(ima);
H2 = eye(3);
imb=vgg_warp_H(img3,H2,'linear',bbox);
imagesc(imb);
im_fused = max(ima,imb); % find new coodinate of Amst-2 as PtD
imagesc(im_fused);

% Q2.2
img1 = double(imread('Amst-1.jpg'))/255;
imagesc(img1);

PtO = [473.18,145.99,1;472.84,135.75,1;486.47,140.57,1;486.92,149.49,1;497.38,152.62,1;497.38,163.47,1;468.82,203.65,1;473.19,197.98,1;465.68,247.22,1;496.35,247.83,1]';
PtD = [77.45,135.13,1;77.45,123.09,1;96.89,129.66,1;96.89,140.6,1;111.21,143.88,1;112.24,158.11,1;74.38,201.87,1;79.5,196.4,1;72.33,252.2,1;113.26,252.2,1]'
% PtD = [577.45,235.13,1;577.45,223.09,1;596.89,229.66,1;596.89,240.6,1;611.21,243.88,1;612.24,258.11,1;574.38,301.87,1;579.5,296.4,1;572.33,352.2,1;613.26,352.2,1;]
bbox1 = [-500 1000 -100 500];
H3 = homography2d(PtO,PtD);
imc=vgg_warp_H(img1,H3,'linear',bbox1);
imagesc(imc);
im_final = max(imc, im_fused);
imagesc(im_final);