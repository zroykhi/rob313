% Q1
imrgb = double(imread('Pompei.jpg'))/255;
imagesc(imrgb);

PtO = [142.44, 44.894, 1; 356.15, 45.761, 1; 111.86, 253.53, 1;370.59, 260.03, 1]'
PtD = [120, 20, 1; 320, 20, 1; 120, 320, 1; 320, 320, 1]'
H = homography2d(PtO,PtD);
imagesc(vgg_warp_H(imrgb,H))

% Q2.1
img2 = double(imread('Amst-2.jpg'))/255;
imagesc(img2)
img3 = double(imread('Amst-3.jpg'))/255;
imagesc(img3)
PtO = [404.08, 154.16, 1;424.04, 154.16, 1;404.08, 186.18, 1;424.04, 186.18, 1;410.18,120.78,1;435.78,122.09,1;404.27,166.2,1;423.31,165.54,1;404.27,171.46,1;423.96,171.46,1;411.34,145.42,1;426.72,144.1,1;476.13,226.51,1;]';
PtD = [22.609, 152.03, 1;43.007, 152.03, 1;22.609, 184.82, 1;43.007, 184.82, 1;30.803,118.02,1;57.783,120.76,1;22.983,165.16,1;43.706,164.61,1;22.592,170.09,1;43.315,170.09,1;30.125,143.27,1;46.771,142.63,1;94.187,225.4,1]';
H1 = homography2d(PtO,PtD);
bbox = [-1500, 500, -100, 500];
ima=vgg_warp_H(img2,H1,'linear',bbox);
imagesc(ima);
H2 = eye(3);
imb=vgg_warp_H(img3,H2,'linear',bbox);
imagesc(imb);
im_fused = max(ima,imb); % find new coodinate of Amst-2 as PtD
imagesc(im_fused);

% Q2.2
img1 = double(imread('Amst-1.jpg'))/255;
imagesc(img1)
% PtO = [472.18, 135.74, 1;486.42, 139.97, 1;472.18, 146.31, 1;486.42, 149.13, 1]';
% PtD = [151.51, 136.34, 1;165.96, 141.96, 1;151.51, 146.46, 1;165.96, 149.83, 1]';
% PtD = [651.51, 236.34, 1;665.96, 241.96, 1;651.51, 246.46, 1;665.96, 249.83, 1]'; % coodinate in im_fused

PtO = [472.83,145.72,1;472.88,135.01,1;486.6,140.05,1;486.92,149.49,1;468.82,203.65,1;473.19,197.98,1]'%;485.11,148.4,1;;466.01,264.46,1;496.59,247.72,1;
PtD = [78.2,134.45,1;76.9,123.09,1;97,129.66,1;97,140.6,1;75.2,202.96,1;79.4,196.4,1]'%;95.6,141.69,1;72.4,252.2,1;113.1,251.06,1;
% PtD = [1078.2,234.45,1;1076.9,223.09,1;1097,229.66,1;1097,240.6,1;1075.2,302.96,1;1079.4,296.4,1;1095.6,241.69,1;1072.4,352.2,1;1113.1,351.06,1]'; % coodinate in im_fused
% PtD = [651.51, 236.34, 1;665.96, 241.96, 1;641.29, 350.84, 1;672.31, 348.33, 1]'; % coodinate in im_fused
bbox1 = [-1000 1000 -100 500];
H3 = homography2d(PtO,PtD);
% bbox1 = [-500 1000 -100 500];
imc=vgg_warp_H(img1,H3,'linear',bbox1);
imagesc(imc);
im_final = max(imc, im_fused)
imagesc(im_final)